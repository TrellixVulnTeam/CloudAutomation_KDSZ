"""
Socket Module
==========
"""

import os
import socket
import logging
from lxk_testlib import status

LOGGER = logging.getLogger(__name__)
LOGGER.setLevel(logging.DEBUG)

def send(ip_address, file, wait_for_timeout=True, timeout=10, port=9100):
    """
    Send file to printer as a command using specific port, default port is 9100.

    :Parameters:
        1. ip_address: Printer IPv4 Address
        2. file: file
        3. port: printer port; defaults is 9100        

    :Returns: ``Str``

        1. Output from the command file, sample command file is npa or pjl.

    """
    LOGGER.debug(ip_address)
    LOGGER.debug(file)
    LOGGER.debug(wait_for_timeout)
    LOGGER.debug(timeout)
    LOGGER.debug(port)    
    
    timeout = int(timeout)
    port = int(port)
    
    if not os.path.exists(file):
        assert False, "Could not find " + file + "!!!"
        
    s = socket.socket()   
    s.settimeout(timeout)    
    
    try:
        s.connect((ip_address, port))
        f = open(file,'rb')        
        l = f.read(1024)
        LOGGER.debug("Sending {} to {} using port {} ..".format(file, ip_address, port))
        while (l):            
            s.send(l)
            l = f.read(1024)
        f.close()        
        LOGGER.debug("Done sending....")
        
        if wait_for_timeout == True:
            LOGGER.debug("Wait for result")
            result = s.recv(1024)      
        else:            
            LOGGER.debug("Dont wait for feedback..")
            result = True
            
        s.shutdown(socket.SHUT_WR)        
        s.close                    
        return result
    except Exception as msg:
        s.shutdown(socket.SHUT_WR)        
        s.close
        LOGGER.debug(msg)
        assert False, "Error: {} !!!".format(msg)

#send("10.194.6.155", "/users/cvelasquez/git/lettuce-runner/features/tests/cattable/googledrive_e5_mfp-3.3.4.fls")
 